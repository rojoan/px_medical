<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <title>客户端</title>
	<link rel="stylesheet" type="text/css" href="../style/css/css.css?v=17.11.24" />
    <script src="../style/lib/js/loadScript.js" type="text/javascript"></script>
</head>
<body>
    <!--top start-->
    <header>
        <div class="top form_add">
            <div class="fl">
                <a href="javascript: history.back();"><i class="iconfont back">&#xe89b;</i></a>
            </div>
            <div class="txt form_add">下转申请</div>
            <div class="fr">
            	<a href="../index.html"><i class="iconfont back">&#xe60b;</i></a>
            </div>
        </div>
    </header>
    <!--top end  article start-->
    <article class="top-min">
    	<form id="editForm" action="">
    		<input type="hidden" id="hdType" name="hdType" value="2" />
    		<input type="hidden" id="patientId" name="patientId" />
    		<input type="hidden" id="patientNo" name="patientNo" />
    		<input type="hidden" id="transStatus" name="transStatus" />
    		<input type="hidden" id="patientType" name="patientType" />
    		<input type="hidden" id="inpatientId" name="inpatientId" />
    		<input type="hidden" id="hdDiagnosisNum" name="hdDiagnosisNum" />
    		<input type="hidden" id="hospitalNoDown" name="hospitalNoDown" />
    		<input type="hidden" id="hdDiagnosisApplyId" name="hdDiagnosisApplyId" />
    		<input type="hidden" id="autoCheckFlag" name="autoCheckFlag" value="0" />
    		<input type="hidden" id="institutionPhoneDow" name="institutionPhoneDow" />
	        <div class="head_clear"></div>
	        <div class="con_tit">患者基本信息</div>
	        <div class="form_list bg_round_white">
	            <dl>
	                <dt>
	                    <label>就诊卡号</label><input type="text" id="patientCardNo" class="input-txt" readonly >
	                </dt>
	                <dt>
	                    <label>医/农保证号</label><input type="text" id="insuranceNo" class="input-txt" readonly>
	                </dt>
	                <dt>
	                    <label>患者姓名</label><input type="text" id="patientName" name="patientName" class="input-txt" readonly>
	                </dt>
	                <dt>
	                    <label>患者性别</label><input type="text" id="patientSex" class="input-txt" readonly>
	                </dt>
	                <dt>
	                    <label>身份证号</label><input type="text" id="patientIdCard" class="input-txt" readonly>
	                </dt>
	                <dt>
	                    <label>出生日期</label><input type="text" id="patientBirth" class="input-txt" readonly>
	                </dt>
	                <dt>
	                    <label>联系电话</label><input type="text" id="patientPhone" class="input-txt" readonly>
	                </dt>
	                <dt>
	                    <label>患者年龄</label><input type="text" id="currentAge" class="input-txt" readonly>
	                </dt>
	                <dt class="input-row">
	                    <label>联系地址</label><input type="text" id="patientNowAddr" class="input-txt" readonly>
	                </dt>
	            </dl>
	        </div>
	        
	        <div class="con_tit">转入医院信息</div>
	        <div class="form_list bg_round_white">
	            <dl>
	                <dt>
	                    <label>转入医院</label>
		                <select id="institutionUpId" name="institutionUpId" class="form-select" onchange="common.loadDep(this.value, 'officeUpId')"></select>
	                </dt>
	                <dt>
	                    <label>转入科室</label>
		                <select id="officeUpId" name="officeUpId" class="form-select" onchange="common.loadDoctor(this.value, 'doctorUpId')"></select>
	                </dt>
	                <dt>
	                    <label>转入医生</label>
		                <select id="doctorUpId" name="doctorUpId" class="form-select"></select>
	                </dt>
	                <dt>
	                    <label>医生电话</label>
	                    <input type="text" id="institutionPhoneUp" name="institutionPhoneUp" class="input-txt" >
	                </dt>
	                <dt class="input-row">
	                    <label>转诊目的</label>
	                    <select id="transAim" name="transAim" class="form-select">
	                    	<option value=""></option>
	                    	<option value="1">诊断</option>
	                    	<option value="2">检查</option>
	                    	<option value="3">治疗</option>
	                    	<option value="4">康复</option>
	                    </select>
	                </dt>
	                <dt class="textarea">
	                    <label>转诊原因</label>
	                    <textarea id="transReason" name="transReason" class="text"></textarea>
	                </dt>     
	            </dl>
	        </div>
	   
	        <div class="con_tit">转出单位信息</div>
	        <div class="form_list bg_round_white">
	            <dl>
	                <dt>
	                    <label>转出科室</label>
		                <select id="offficeDownId" name="offficeDownId" class="form-select" onchange="common.loadDoctor(this.value, 'doctorDownId')"></select>
	                </dt>
	                <dt>
	                    <label>转出医生</label>
		                <select id="doctorDownId" name="doctorDownId" class="form-select"></select>
	
	                </dt>
	                <dt>
	                    <label>医生电话</label>
	                    <input type="text" id="doctorMobileDown" name="doctorMobileDown" class="input-txt" >
	                </dt>
	                <dt>
	                    <label>自动审核</label>
	                    <select id="autoCheckFlag" name="autoCheckFlag" class="form-select">
		                	<option value="0">否</option>
		                    <option value ="1">是</option>
		                </select>
	                </dt>
	            </dl>
	        </div>
	        
	        <div class="con_tit" >转诊信息</div>
	        <div class="form_list bg_round_white">
	            <dl>
	                <dt class="textarea">
	                    <label>转诊诊断</label>
	                    <textarea id="diagnosisDown" name="diagnosisDown" class="text"></textarea>
	                </dt>
	                <dt class="textarea">
	                    <label>转诊检查结果</label>
	                    <textarea id="diagnosisResultDown" name="diagnosisResultDown" class="text"></textarea>
	                </dt>
	                   <dt class="textarea">
	                    <label>转诊治疗经过</label>
	                    <textarea id="diagnosisCureDown" name="diagnosisCureDown" class="text"></textarea>
	                </dt>
	                <dt class="textarea">
	                    <label>转诊康复建议</label>
	                    <textarea id="recoverySuggestDown" name="recoverySuggestDown" class="text"></textarea>
	                </dt>
	                <dt>
	                    <label>手术名称</label>
	                    <input type="text" id="operationDown" name="operationDown" class="input-txt" >
	                </dt>
	                <dt>
	                    <label>手术时间</label>
	                    <input type="text" id="operationTimeDown" name="operationTimeDown" class="input-txt" >
	                </dt>
	            </dl>
	        </div>
	
	        <div class="form-clear"></div>   
	        <div class="form_btn w w2">
	            <dl>
	            	<dt><a href="javascript:void(0);" onclick="downApply.save(2)">转诊申请</a></dt>
	            	<dt><a href="javascript:void(0);" onclick="downApply.save(0)">暂 存 </a></dt>
	            </dl>	            
	        </div>
        </form>
    </article>
    <!--article end-->
</body>
<script type="text/javascript">
	//初始化日期控件
	;!function(){
		//laydate.skin('molv');
		laydate({
		   elem: '#operationTimeDown',
		   format: 'YYYY-MM-DD hh:mm',
		   start: laydate.now(0, 'YYYY-MM-DD hh:mm:ss'),
		   festival: true,
		   istime: true
		});
	}();

// 	;!function(){
// 		//laydate.skin('molv');
// 		laydate({
// 		   elem: '#operationTimeDown',
// 		   format: 'YYYY-MM-DD hh:mm',
// 		   start: laydate.now(0, 'YYYY-MM-DD hh:mm:ss'),
// 		   festival: true,
// 		   istime: true
// 		});
// 	}();
	var downApply = {
		loadData: function () {
			common.loading();
			$.post(
				rootPath + '/mobile.patient/showOutPatientInfo.do', 
				{outpatientInhospitalId: common.getCache(common.rowId)},
				function(data){
					var outpatient = data.outpatient;
					var patient = data.patient;
					if (null != patient && patient != undefined) {
						$('#patientId').val(patient.patientId);
		                $('#patientCardNo').val(patient.patientCardNo);
		                $('#insuranceNo').val(patient.insuranceNo);
						$('#patientName').val(patient.patientName);
						$('#patientSex').val(common.getSex(patient.patientSex));
						$('#patientIdCard').val(patient.patientIdCard);
						$('#patientBirth').val(patient.patientBirth);
						$('#patientPhone').val(patient.patientPhone);
						$('#currentAge').val(patient.currentAge);
						$('#patientNowAddr').val(patient.patientNowAddr);
					}
					if (null != outpatient && outpatient != undefined) {
						$('#hospitalNoDown').val(outpatient.hospitalNo);
						if (null != outpatient.inhospitalId && outpatient.inhospitalId != undefined && outpatient.inhospitalId != "") {
							$('#patientType').val(1);
					    	$('#inpatientId').val(outpatient.inhospitalId);
						} else if (null != outpatient.outpatientId && outpatient.outpatientId != undefined && outpatient.outpatientId != "") {
							$('#patientType').val(2);
					    	$('#inpatientId').val(outpatient.outpatientId);
						}
					}
					common.loaded();
			}, 'json');	
		},
		save: function (transStatus){
			var saveParams = $('#editForm').serializeObject();

			var json = JSON.parse(common.getLocalCache(common.currentUserInfo));
			saveParams.orgId = json.unitOrgId;
			saveParams.institutionDownName = json.unitName;
			saveParams.institutionDownId = saveParams.orgId;
			saveParams.transStatus = transStatus;
			saveParams.officeUpName = $('#officeUpId').find("option:selected").text();
			saveParams.doctorUpName = $('#doctorUpId').find("option:selected").text();
			saveParams.officeDownName = $('#offficeDownId').find("option:selected").text();
			saveParams.doctorDownName = $('#doctorDownId').find("option:selected").text();
			saveParams.institutionUpName = $('#institutionUpId').find("option:selected").text();
			// 转入医院编码
			saveParams.hospitalNoUp = $('#institutionUpId').find("option:selected").attr("title");
			if (saveParams.patientId == undefined || saveParams.patientId == "") {
				alert("患者信息不存在");
				return false;
			}
			if (saveParams.institutionUpId == undefined || saveParams.institutionUpId == "") {
				alert("请选择转入医院");
				return false;
			}
			if (saveParams.officeUpId == undefined || saveParams.officeUpId == "") {
				alert("请选择转入科室");
				return false;
			}
			if (saveParams.doctorUpId == undefined || saveParams.doctorUpId == "") {
				alert("请选择转入医生");
				return false;
			}
			if (saveParams.transAim == undefined || saveParams.transAim == "") {
				alert("请选择转诊目的");
				return false;
			}
			if (saveParams.institutionPhoneUp == undefined || saveParams.institutionPhoneUp == "") {
				alert("请填写转出医院联系电话！");
				return false;
			}
			if (saveParams.transReason == undefined || saveParams.transReason == "") {
				alert("请选择转诊原因");
				$("#transReason").focus();
				return false;
			}
			if (saveParams.offficeDownId == undefined || saveParams.offficeDownId == "") {
				alert("请选择转出科室");
				return false;
			}
			if (saveParams.doctorDownId == undefined || saveParams.doctorDownId == "") {
				alert("请填写转出医生");
				return false;
			}
			if (saveParams.doctorMobileDown == undefined || saveParams.doctorMobileDown == "") {
				alert("请填写转出医生联系电话");
				$("#doctorMobileDown").focus();
				return false;
			}
			if (saveParams.diagnosisDown == undefined || saveParams.diagnosisDown == "") {
				alert("请填写转诊诊断");
				$("#diagnosisDown").focus();
				return false;
			}
			if (saveParams.diagnosisResultDown == undefined || saveParams.diagnosisResultDown == "") {
				alert("请填写转诊检查结果");
				$("#diagnosisResultDown").focus();
				return false;
			}
			if (saveParams.diagnosisCureDown == undefined || saveParams.diagnosisCureDown == "") {
				alert("请填写转诊治疗经过");
				$("#diagnosisCureDown").focus();
				return false;
			}
			if (saveParams.recoverySuggestDown == undefined || saveParams.recoverySuggestDown == "") {
				alert("请填写转诊康复建议");
				$("#recoverySuggestDown").focus();
				return false;
			}
			
			common.loading();
			$.post(rootPath + "/mobile.diagnosi/saveDiagnosisApply.jo", saveParams, 
				function(result){
					if (result.code == "0") {
						$('#submitFlag').val("1");
						alert("保存成功");
						//回显后台新增属性的值
						$("#hdDiagnosisApplyId").val( result.data.hdDiagnosisApplyId);
						$("#hdDiagnosisNum").val(result.data.hdDiagnosisNum);
						$("#institutionPhoneDow").val(result.data.institutionPhoneDow);
					} else {
						alert("保存失败");
						$('#submitFlag').val("");
					}
					common.loaded();
			}, "json");
		}
	}
	$(function (){
		downApply.loadData();
		common.loadUnit('institutionUpId');
		
		var json = JSON.parse(common.getLocalCache(common.currentUserInfo));
		common.loadDep(json.unitOrgId, 'offficeDownId');
	});
</script>
</html>