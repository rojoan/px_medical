<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <title>客户端</title>
    <link href="../style/css/css.css" type="text/css" rel="stylesheet" />
    <script src="../style/lib/js/loadScript.js" type="text/javascript"></script>
    
</head>
<body>
    <!--top start-->
    <header>
        <div class="top form_add">
            <div class="fl">
                <a href="javascript:history.back()"><i class="iconfont back">&#xe89b;</i></a>
            </div>
            <div class="txt form_add">会诊详情</div>
            <div class="fr">
            	<a href="../index.html"><i class="iconfont back">&#xe60b;</i></a>
            </div>
        </div>
    </header>
    <!--top end    article start-->
    <article class="top-min">
        <div class="head_clear"></div>
        <div class="main">
            <div class="main_left" id="frmTitle" >
                <div class="picBox" onclick="switchSysBar()" id="switchPoint" ><i class="iconfont">&#xec56;</i></div>
                <ul id="tabMenu" class="side-menu">
                	<li onclick="receive.changeTab(1)">
	                    <i class="iconfont">&#xe673;</i> 
	                    <span>接诊信息</span>
                    </li>
                    <li onclick="receive.changeTab(2)">
	                    <i class="iconfont">&#xe603;</i> 
	                    <span>患者信息</span>
                    </li>
                    <li onclick="receive.changeTab(3)">
                    	<i class="iconfont">&#xe605;</i> 
                    	<span>转诊信息</span>
                    </li>
                    <li onclick="receive.changeTab(4)">
                    	<i class="iconfont">&#xe63d;</i> 
                    	<span>影像资料</span>
                    </li>
                </ul>
            </div>
            <div class="main_right" id="frmMain">
            	<div class="form_list" id="tab1" style="display: none">
            		<form id="editForm" action="">
				        <div class="con_tit">接诊信息</div>
				        <div class="bg_round_white">
				            <dl>
				            	<dt>
				                    <label>接诊科室</label>
				                    <input type="text" id="clinicalOfficeName" class="input-txt" readonly>
				                </dt>
				                <dt>
				                    <label>接诊医生</label>
				                    <input type="text" id="clinicalDoctorName" class="input-txt" readonly>
				                </dt>
				                <dt class="input-row">
				                    <label>接诊状态</label>
				                    <select id="transStatus" name="transStatus" class="form-select">
				                    	<option value=""></option>
					                	<option value="3">同意接诊</option>
					                    <option value ="5">拒绝接诊</option>
					                </select>
				                </dt>
				                <dt class="textarea">
				                    <label>接诊意见</label>
				                    <textarea id="checkOpinion" name="checkOpinion" class="text" rows="8"></textarea>
				                </dt>
				            </dl>
				        </div>
				        <div class="form-clear"></div>   
				        <div class="form_btn w">
				            <dl>	            	
			            		<dt><a href="javascript:void(0);" onclick="receive.save()">提 交</a></dt>	            	
				            </dl>
				        </div>
			        </form>
                </div>
            	
            	
                <div class="form_list" id="tab2" style="display: none">
			        <div class="con_tit">患者基本信息</div>
			        <div class="bg_round_white">
			            <dl>
			                <dt>
			                    <label>就诊卡号</label>
			                    <input id="patientCardNo" type="text" class="input-txt" readonly >
			                </dt>
			                <dt>
			                    <label>医/农保证号</label>
			                    <input id="insuranceNo" type="text" class="input-txt" readonly>
			                </dt>
			                <dt>
			                    <label>患者姓名</label>
			                    <input id="patientId" type="hidden" class="input-txt" />
			                    <input id="patientName" name="patientName" type="text" class="input-txt" readonly>
			                </dt>
			                <dt>
			                    <label>患者性别</label>
			                    <input id="patientSex" type="text" class="input-txt" readonly>
			                </dt>
			                <dt>
			                    <label>身份证号</label>
			                    <input id="patientIdCard" type="text" class="input-txt" readonly>
			                </dt>
			                <dt>
			                    <label>出生日期</label>
			                    <input id="patientBirth" type="text" class="input-txt" readonly>
			                </dt>
			                <dt>
			                    <label>联系电话</label>
			                    <input id="patientPhone" type="text" class="input-txt" readonly>
			                </dt>
			                <dt>
			                    <label>患者年龄</label>
			                    <input id="currentAge" type="text" class="input-txt" readonly>
			                </dt>
			                <dt class="input-row">
			                    <label>现住地址</label>
			                    <input id="patientNowAddr" type="text" class="input-txt" readonly>
			                </dt>
			            </dl>
			        </div>
                </div>
                <div class="form_list" id="tab3" style="display: none">
			        <div class="con_tit">转入医院信息</div>
			        <div class="bg_round_white">
			            <dl>
			                <dt>
			                    <label>转入科室</label>
				                <input id="officeUpName" type="text" class="input-txt" readonly>
			                </dt>
			                <dt>
			                    <label>转入医生</label>
				                <input id="doctorUpName" type="text" class="input-txt" readonly>
			                </dt>
			                <dt>
			                    <label>医生电话</label>
			                    <input type="text" id="institutionPhoneUp" name="institutionPhoneUp" class="input-txt" readonly>
			                </dt>
			                <dt>
			                    <label>转诊目的</label>
			                    <select id="transAim" name="transAim" class="form-select" disabled>
			                    	<option value=""></option>
			                    	<option value="1">诊断</option>
			                    	<option value="2">检查</option>
			                    	<option value="3">治疗</option>
			                    	<option value="4">康复</option>
			                    </select>
			                </dt>
			                <dt class="textarea">
			                    <label>转诊原因</label><textarea id="transReason" name="transReason" class="text" readonly></textarea>
			                </dt>           
			            </dl>
			        </div>
			   
			        <div class="con_tit">转出单位信息</div>
			        <div class="bg_round_white">
			            <dl>
			            	<dt class="input-row">
			                    <label>转出医院</label>
			                    <input id="institutionDownName" type="text" class="input-txt" readonly>
			                </dt>
			                <dt>
			                    <label>转出科室</label>
				                <input id="officeDownName" type="text" class="input-txt" readonly>
			                </dt>
			                <dt>
			                    <label>转出医生</label>
				                <input id="doctorDownName" type="text" class="input-txt" readonly>
			                </dt>
			                <dt>
			                    <label>医生电话</label>
			                    <input type="text" id="doctorMobileDown" name="doctorMobileDown" class="input-txt" readonly>
			                </dt>
			                <dt>
			                	<label>自动审核</label>
				                <select id="autoCheckFlag" name="autoCheckFlag" class="form-select" disabled>
				                	<option value="0">否</option>
				                    <option value ="1">是</option>
				                </select>
			                </dt>
			                <dt>
			                    <label>开始有效期</label>
			                    <input type="text" id="validStartTime" name="validStartTime" class="input-txt" readonly>
			                </dt>
			                <dt>
			                	<label>截止有效期</label>
			                    <input type="text" id="validEndTime" name="validEndTime" class="input-txt" readonly>
			                </dt>
			            </dl>
			        </div>
			        
			        <div class="con_tit" id="showTitle1" style="display: none">上转信息</div>
			        <div class="bg_round_white" id="show1" style="display: none">
			            <dl>
			                <dt class="textarea">
			                    <label>初步印象（主诉）</label>
			                    <textarea id="firstImpressUp" name="firstImpressUp" class="text" readonly></textarea>
			                </dt>
			                <dt class="textarea">
			                    <label>初步诊断</label>
			                    <textarea id="firstDiagnosisUp" name="firstDiagnosisUp" class="text" readonly></textarea>
			                </dt>
			                   <dt class="textarea">
			                    <label>主要现病史</label>
			                    <textarea id="mainSickUp" name="mainSickUp" class="text" readonly></textarea>
			                </dt>
			                <dt class="textarea">
			                    <label>主要既往史</label>
			                    <textarea id="historySickUp" name="historySickUp" class="text" readonly></textarea>
			                </dt>
			                <dt class="textarea">
			                    <label>治疗经过</label>
			                    <textarea id="cureUp" name="cureUp" class="text" readonly></textarea>
			                </dt>
			            </dl>
			        </div>
			        
			        <div class="con_tit" id="showTitle2" style="display: none">下转信息</div>
			        <div class="bg_round_white" id="show2" style="display: none">
			            <dl>
			                <dt class="textarea">
			                    <label>转诊诊断</label>
			                    <textarea id="diagnosisDown" name="diagnosisDown" class="text" readonly></textarea>
			                </dt>
			                <dt class="textarea">
			                    <label>转诊检查结果</label>
			                    <textarea id="diagnosisResultDown" name="diagnosisResultDown" class="text" readonly></textarea>
			                </dt>
			                <dt class="textarea">
			                    <label>转诊治疗经过</label>
			                    <textarea id="diagnosisCureDown" name="diagnosisCureDown" class="text" readonly></textarea>
			                </dt>
			                <dt class="textarea">
			                    <label>转诊康复建议</label>
			                    <textarea id="recoverySuggestDown" name="recoverySuggestDown" class="text" readonly></textarea>
			                </dt>
			                <dt>
			                    <label>手术名称</label>
			                    <input type="text" id="operationDown" name="operationDown" class="input-txt" readonly>
			                </dt>
			                <dt>
			                    <label>手术日期</label>
			                    <input type="text" id="operationTimeDown" name="operationTimeDown" class="input-txt"readonly >
			                </dt>
			            </dl>
			        </div>
                </div>

                <div class="form_list" id="tab4" style="display: none">
                	<input type="hidden" id="patientType" value="" />
                	<input type="hidden" id="inpatientId" value="" />
                	<input type="hidden" id="patientId" value="" />
                	<input type="hidden" id="institutionDownId" value="" />
                    <iframe id="pacdImage" src="" width="100%" height="100%" style="border: none"></iframe>
                </div>

            </div>
        </div>
    </article>
    <!--article end-->
</body>
<script type="text/javascript">
	var receive = {
		patientId: "",
		changeTab: function (index){
			var array = ['tab', index];
			var targetDiv = array.join('');
			$('#frmMain').find("div.form_list").each(function (){
				if (this.id == targetDiv) {
					$(this).show();
					receive.loadData(index, targetDiv);
					common.historyTab[targetDiv] = targetDiv;
				} else {
					$(this).hide();
				}
			});
		},
		getDiagnosisInfo: function(){
			common.loading();
			$.post(
				rootPath + '/mobile.diagnosi/applyDetail.do', 
				{hdDiagnosisApplyId: common.getCache(common.rowId)},
				function(result){
					var patient = result.data.patient;
					var diagnosisApply = result.data.hdDiagnosisApply;
					
					if (patient != undefined) {
						$('#patientId').val(patient.patientId);
		                $('#patientCardNo').val(patient.patientCardNo);
		                $('#insuranceNo').val(patient.insuranceNo);
						$('#patientName').val(patient.patientName);
						$('#patientSex').val(common.getSex(patient.patientSex));
						$('#patientIdCard').val(patient.patientIdCard);
						$('#patientBirth').val(patient.patientBirth);
						$('#patientPhone').val(patient.patientPhone);
						$('#currentAge').val(patient.currentAge);
						$('#patientNowAddr').val(patient.patientNowAddr);
					}
					if (diagnosisApply != undefined) {
                		$('#patientType').val(diagnosisApply.patientType);
                		$('#inpatientId').val(diagnosisApply.inpatientId);
                		$('#patientId').val(diagnosisApply.patientId);
                		$('#institutionDownId').val(diagnosisApply.institutionDownId);
						
						$('#transAim').val(diagnosisApply.transAim);
						$('#transReason').val(diagnosisApply.transReason);
		                $('#officeUpName').val(diagnosisApply.officeUpName);
		                $('#doctorUpName').val(diagnosisApply.doctorUpName);
		                $('#institutionPhoneUp').val(diagnosisApply.institutionPhoneUp);

		                $('#institutionDownName').val(diagnosisApply.institutionDownName);
						$('#officeDownName').val(diagnosisApply.officeDownName);
		                $('#doctorDownName').val(diagnosisApply.doctorDownName);
		                $('#doctorMobileDown').val(diagnosisApply.doctorMobileDown);
		                $('#autoCheckFlag').val(diagnosisApply.autoCheckFlag);
		                $('#validStartTime').val(diagnosisApply.validStartTime);
		                $('#validEndTime').val(diagnosisApply.validEndTime);
		                
		                $('#firstImpressUp').val(diagnosisApply.firstImpressUp);
						$('#firstDiagnosisUp').val(diagnosisApply.firstDiagnosisUp);
		                $('#mainSickUp').val(diagnosisApply.mainSickUp);
		                $('#historySickUp').val(diagnosisApply.historySickUp);
		                $('#cureUp').val(diagnosisApply.cureUp);
		                
		                $('#diagnosisDown').val(diagnosisApply.diagnosisDown);
						$('#diagnosisResultDown').val(diagnosisApply.diagnosisResultDown);
		                $('#diagnosisCureDown').val(diagnosisApply.diagnosisCureDown);
		                $('#recoverySuggestDown').val(diagnosisApply.recoverySuggestDown);
		                $('#operationDown').val(diagnosisApply.operationDown);
		                $('#operationTimeDown').val(diagnosisApply.operationTimeDown);
		                
		                $('#auditStatus').val(common.auditStatus(diagnosisApply.transStatus));
		                $('#checkDoctorName').val(diagnosisApply.checkDoctorName);
		                $('#checkOpinion').val(diagnosisApply.checkOpinion);
		                
		    			// 根据转诊类型（hdType 1：上转；2：下转）显示上转或下转的信息
		    			$('#show' + diagnosisApply.hdType).show();
		    			$('#showTitle' + diagnosisApply.hdType).show();
		    			
		    			common.loaded();
					}
			}, 'json');	
		},
		save: function (){
			var saveParams = $('#editForm').serializeObject();
			saveParams.ids = common.getCache(common.rowId);
			$.post(rootPath + '/mobile.diagnosi/receivePatient.do', saveParams, function (result){
				if (result.code == "0") {
					alert("提交成功");
					history.back();
				} else {
					alert(result.msg);
				}
			}, 'json');
		},
		loadData: function (index, tabId) {
			if (common.historyTab[tabId] != undefined && common.historyTab[tabId] != "") {
				return ;
			}
			switch(index) {
			case 1:
				var json = JSON.parse(common.getLocalCache(common.currentUserInfo));
				$('#clinicalDoctorName').val(json.userName);
				$('#clinicalOfficeName').val(json.orgName);
				break;
			case 2:
				receive.getDiagnosisInfo();
				break;
			case 3:
				break;
			case 4:
				var param = {};
				param.patientId = $('#patientId').val();
				param.patientType = $('#patientType').val();
				param.inpatientId = $('#inpatientId').val();
				param.orgId = $('#institutionDownId').val();
				common.loading();
				$.post(rootPath + "/pacs/findPatientExamInfo.do", param, function(result) {
					if (result.data && result.data.patientExamId) {
						$("#pacdImage").height($('#frmMain').height() - 40);
						$('#pacdImage').attr('src', rootPath + '/pacsView/index.html?patientid=' + result.data.patientExamId);
					} else {
						$('#pacsImage').contents().find("body").html("影像内容不存在");
					}
					common.loaded();
				}, "json");
				break;
			default:
			  return ;
			}
		}
	}
	$(function (){
		receive.changeTab(1);
	});
</script>
</html>